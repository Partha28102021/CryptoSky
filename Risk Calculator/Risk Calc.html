<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Position Sizing Calculator for CoinDcx</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #121212;
      color: #ffffff;
    }
    .calculator {
      max-width: 800px;
      margin: 20px auto;
      padding: 40px;
      border: 1px solid #333;
      border-radius: 20px;
      background-color: #1e1e1e;
    }
    h2 {
      text-align: center;
      color: #ffffff;
      font-size: 28px;
    }
    input {
      width: 100%;
      padding: 16px;
      margin: 20px 0;
      box-sizing: border-box;
      background-color: #333;
      border: 1px solid #444;
      color: #ffffff;
      font-size: 24px;
    }
    button {
      width: 100%;
      padding: 20px;
      background-color: #007bff;
      color: #FF8C00;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 24px;
      font-weight: bold;
    }
    button:hover {
      background-color: #0056b3;
    }
    .result {
      margin-top: 40px;
      padding: 20px;
      background-color: #333;
      border-radius: 10px;
      color: #00BFFF;
      font-size: 24px;
    }
    .result h3 {
      color: #00FF00;
      font-size: 32px;
    }
    .result p {
      color: #00BFFF;
    }
    .result strong {
      color: #FF8C00;
      margin-right: 10px;
    }
    .trade-type {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    .trade-type button {
      width: 48%;
      padding: 20px;
      border: 2px solid #ffffff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 24px;
      background-color: #1e1e1e;
      color: #ffffff;
    }
    .trade-type button.selected {
      color: white;
    }
    .trade-type button#buyButton.selected {
      background-color: #28a745;
      border-color: #28a745;
    }
    .trade-type button#sellButton.selected {
      background-color: #dc3545;
      border-color: #dc3545;
    }
    .capital-required {
      color: #00FF00; /* Green by default */
    }
    .capital-required.insufficient {
      color: #FF0000; /* Red if insufficient */
    }
    /* Updated styles for Entry Price and Stop Loss labels */
    label[for="entryPrice"] {
      color: #00FF00; /* Green for Entry Price */
      font-size: 28.8px; /* 20% larger than 24px */
    }
    label[for="stopLoss"] {
      color: #FF0000; /* Red for Stop Loss */
      font-size: 28.8px; /* 20% larger than 24px */
    }
    /* Increase font size for all headings except Entry Price and Stop Loss */
    label:not([for="entryPrice"]):not([for="stopLoss"]) {
      font-size: 28.8px; /* 20% larger than 24px */
    }
    /* Style for Max Leverage description */
    label[for="maxLeverage"] {
      font-size: 24px; /* Slightly smaller than the heading */
    }
    label[for="maxLeverage"] span {
      color: #888; /* Dark grey for description */
      font-size: 20px; /* Smaller font size for description */
    }
    /* Style for Risk Percentage */
    .risk-percentage {
      font-size: 20px; /* Smaller font size */
      color: #00FF00; /* Green color */
      margin-left: 10px; /* Spacing from the label */
    }
  </style>
</head>
<body>

  <div class="calculator">
    <h2>Crypto Position Sizing Calculator for CoinDcx</h2>
    
    <label for="riskInr">Risk in INR:</label>
    <input type="number" id="riskInr" placeholder="Enter risk in INR" value="200">
    
    <label for="capitalUsdt">Available Capital (In USDT): <span id="riskPercentage" class="risk-percentage"></span></label>
    <input type="number" id="capitalUsdt" placeholder="Enter available capital in USDT">
    
    <label for="maxLeverage">Max Leverage <span>(Given in CoinDCX platform - Use less leverage to get far liquidation price, so stop loss can be big)</span>:</label>
    <input type="number" id="maxLeverage" placeholder="Enter max leverage">
    
    <label for="entryPrice">Entry Price (USDT):</label>
    <input type="number" id="entryPrice" step="0.0000001" placeholder="Enter entry price">
    
    <label for="stopLoss">Stop Loss Price (USDT):</label>
    <input type="number" id="stopLoss" step="0.0000001" placeholder="Enter stop loss price">
    
    <label for="rrRatio">Risk-to-Reward Ratio (e.g., 2 for 1:2):</label>
    <input type="number" id="rrRatio" placeholder="Enter RR ratio (e.g., 2)" value="2">
    
    <div class="trade-type">
      <button id="buyButton" onclick="selectTradeType('buy')">Buy</button>
      <button id="sellButton" onclick="selectTradeType('sell')">Sell</button>
    </div>
    
    <button onclick="calculatePosition()">Calculate Position</button>
    
    <div class="result" id="result">
      <!-- Results will be displayed here -->
    </div>
  </div>

  <script>
    let tradeType = 'buy'; // Default trade type is 'buy'

    // Function to select trade type (Buy/Sell)
    function selectTradeType(type) {
      tradeType = type;
      const buyButton = document.getElementById('buyButton');
      const sellButton = document.getElementById('sellButton');

      if (type === 'buy') {
        buyButton.classList.add('selected');
        sellButton.classList.remove('selected');
      } else {
        sellButton.classList.add('selected');
        buyButton.classList.remove('selected');
      }
    }

    // Function to calculate position size
    function calculatePosition() {
      // Get input values
      const riskInr = parseFloat(document.getElementById('riskInr').value);
      const capitalUsdt = parseFloat(document.getElementById('capitalUsdt').value);
      const maxLeverage = parseFloat(document.getElementById('maxLeverage').value);
      const entryPrice = parseFloat(document.getElementById('entryPrice').value);
      const stopLoss = parseFloat(document.getElementById('stopLoss').value);
      const rrRatio = parseFloat(document.getElementById('rrRatio').value);

      // Constants
      const usdtToInr = 87.43; // 1 USDT = 87.43 INR (updated conversion rate)

      // Calculate risk in USDT
      const riskUsdt = riskInr / usdtToInr;

      // Calculate price difference (risk)
      const priceDifference = Math.abs(entryPrice - stopLoss);

      // Calculate position size in tokens
      const positionSizeTokens = riskUsdt / priceDifference;

      // Calculate position size in USDT
      const positionSizeUsdt = positionSizeTokens * entryPrice;

      // Calculate required capital based on max leverage
      const requiredCapital = positionSizeUsdt / maxLeverage;

      // Check if capital is sufficient (including equality case)
      const isCapitalSufficient = capitalUsdt >= requiredCapital;

      // Calculate profit-taking price based on RR ratio
      let takeProfitPrice;
      if (tradeType === 'buy') {
        takeProfitPrice = entryPrice + (priceDifference * rrRatio); // Buy: Entry + (RR × Risk)
      } else {
        takeProfitPrice = entryPrice - (priceDifference * rrRatio); // Sell: Entry - (RR × Risk)
      }

      // Determine decimal precision for take profit price
      const entryDecimalPlaces = (entryPrice.toString().split('.')[1] || '').length;
      const stopLossDecimalPlaces = (stopLoss.toString().split('.')[1] || '').length;
      const maxDecimalPlaces = Math.max(entryDecimalPlaces, stopLossDecimalPlaces);

      // Display results
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <h3>Results:</h3>
        <p><strong>Trade Type:</strong> ${tradeType === 'buy' ? 'Buy' : 'Sell'}</p>
        <p><strong>Position Size (Tokens) (Approx):</strong> ${positionSizeTokens.toFixed(2)}</p>
        <p><strong>Position Size (USDT) (Approx):</strong> ${positionSizeUsdt.toFixed(2)} USDT</p>
        <p><strong>Required Capital:</strong> <span class="capital-required ${isCapitalSufficient ? '' : 'insufficient'}">${requiredCapital.toFixed(2)} USDT</span></p>
        <p><strong>Take Profit Price:</strong> ${takeProfitPrice.toFixed(maxDecimalPlaces)} USDT</p>
      `;
    }

    // Function to calculate and display risk percentage
    function updateRiskPercentage() {
      const riskInr = parseFloat(document.getElementById('riskInr').value);
      const capitalUsdt = parseFloat(document.getElementById('capitalUsdt').value);
      const usdtToInr = 87.43; // 1 USDT = 87.43 INR (updated conversion rate)

      if (riskInr && capitalUsdt) {
        const riskUsdt = riskInr / usdtToInr;
        const riskPercentage = (riskUsdt / capitalUsdt) * 100;
        document.getElementById('riskPercentage').textContent = `(${riskPercentage.toFixed(2)}% Risk)`;
      } else {
        document.getElementById('riskPercentage').textContent = '';
      }
    }

    // Add event listeners for input fields
    document.getElementById('riskInr').addEventListener('input', updateRiskPercentage);
    document.getElementById('capitalUsdt').addEventListener('input', updateRiskPercentage);

    // Function to handle Enter key press
    function handleEnterKey(event, nextFieldId) {
      if (event.key === 'Enter') {
        event.preventDefault(); // Prevent form submission
        const nextField = document.getElementById(nextFieldId);
        if (nextField) {
          nextField.focus(); // Move focus to the next field
        }
      }
    }

    // Function to handle Enter key press for the Stop Loss field
    function handleStopLossEnter(event) {
      if (event.key === 'Enter') {
        event.preventDefault(); // Prevent form submission
        const buyButton = document.getElementById('buyButton');
        if (buyButton) {
          buyButton.focus(); // Move focus to the Buy button
          selectTradeType('buy'); // Automatically select Buy
        }
      }
    }

    // Function to handle Enter key press for the Buy button
    function handleBuyButtonEnter(event) {
      if (event.key === 'Enter') {
        event.preventDefault(); // Prevent form submission
        calculatePosition(); // Trigger calculation
      }
    }

    // Add event listeners for Enter key
    document.getElementById('capitalUsdt').addEventListener('keypress', (event) => handleEnterKey(event, 'maxLeverage'));
    document.getElementById('maxLeverage').addEventListener('keypress', (event) => handleEnterKey(event, 'entryPrice'));
    document.getElementById('entryPrice').addEventListener('keypress', (event) => handleEnterKey(event, 'stopLoss'));
    document.getElementById('stopLoss').addEventListener('keypress', handleStopLossEnter);
    document.getElementById('buyButton').addEventListener('keypress', handleBuyButtonEnter);

    // Set focus on Available Capital field when the page loads
    window.onload = () => {
      document.getElementById('capitalUsdt').focus();
    };
  </script>

</body>
</html>